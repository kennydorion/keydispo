<!DOCTYPE html>
<html>
<head>
    <title>Test Connexion Firebase</title>
</head>
<body>
    <h1>Test de connexion Firebase</h1>
    <div id="status">Chargement...</div>
    <div id="results"></div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
        import { getFirestore, connectFirestoreEmulator, collection, query, where, orderBy, getDocs } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';

        const firebaseConfig = {
            projectId: 'keydispo-local'
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const statusDiv = document.getElementById('status');
        const resultsDiv = document.getElementById('results');

        function log(message) {
            console.log(message);
            statusDiv.innerHTML += '<br>' + message;
        }

        async function testConnection() {
            try {
                log('üîÑ Connexion √† l\'√©mulateur...');
                
                // Connecter √† l'√©mulateur
                connectFirestoreEmulator(db, 'localhost', 8081);
                log('‚úÖ Connect√© √† l\'√©mulateur Firestore');

                // Test de requ√™te
                log('üîç Test de requ√™te...');
                const q = query(
                    collection(db, 'dispos'),
                    where('tenantId', '==', 'keydispo'),
                    orderBy('date', 'asc')
                );

                const snapshot = await getDocs(q);
                log(`‚úÖ ${snapshot.size} documents trouv√©s`);

                if (snapshot.size > 0) {
                    resultsDiv.innerHTML = '<h2>Premiers r√©sultats:</h2>';
                    snapshot.docs.slice(0, 5).forEach((doc, i) => {
                        const data = doc.data();
                        resultsDiv.innerHTML += `<p>${i+1}. ${data.nom} ${data.prenom} - ${data.date} - ${data.lieu}</p>`;
                    });
                }

            } catch (error) {
                log('‚ùå Erreur: ' + error.message);
                console.error(error);
            }
        }

        testConnection();
    </script>
</body>
</html>
