<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Moteur WASM Ultra-Performant</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }
        
        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            background: #333;
            border-radius: 10px;
            padding: 10px;
            margin: 20px 0;
            max-width: 500px;
            position: relative;
        }
        
        .grid-cell {
            aspect-ratio: 1;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }
        
        .grid-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .grid-cell.highlighted {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(5px);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
            color: #00f2fe;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 30px 0;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .log {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9em;
            line-height: 1.4;
        }
        
        .engine-status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin: 0 10px;
        }
        
        .engine-status.ready {
            background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
        }
        
        .engine-status.loading {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .performance-indicator {
            font-size: 1.2em;
            margin: 15px 0;
            padding: 10px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .emoji {
            font-size: 1.5em;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Moteur WASM Ultra-Performant</h1>
        
        <div style="text-align: center; margin-bottom: 30px;">
            <span class="engine-status loading" id="engineStatus">Initialisation...</span>
        </div>
        
        <div class="performance-indicator" id="performanceIndicator">
            <span class="emoji">‚è±Ô∏è</span>
            Performance: Initialisation en cours...
        </div>
        
        <div class="controls">
            <button class="btn" onclick="runBenchmark()">üèÅ Benchmark Performance</button>
            <button class="btn" onclick="runAccuracyTest()">üéØ Test Pr√©cision</button>
            <button class="btn" onclick="runStressTest()">üí™ Test de Stress</button>
            <button class="btn" onclick="clearLog()">üóëÔ∏è Vider Log</button>
        </div>
        
        <div class="test-grid" id="testGrid" onmousemove="handleGridMouseMove(event)">
            <!-- Grille g√©n√©r√©e par JavaScript -->
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <div>Calculs Totaux</div>
                <div class="stat-value" id="totalCalculations">0</div>
            </div>
            <div class="stat-card">
                <div>Temps Moyen (ms)</div>
                <div class="stat-value" id="averageTime">0.000</div>
            </div>
            <div class="stat-card">
                <div>FPS Th√©orique</div>
                <div class="stat-value" id="theoreticalFPS">‚àû</div>
            </div>
            <div class="stat-card">
                <div>Type de Moteur</div>
                <div class="stat-value" id="engineType">-</div>
            </div>
        </div>
        
        <div>
            <h3>üìã Journal d'Activit√©</h3>
            <div class="log" id="log"></div>
        </div>
    </div>

    <script type="module">
        // Simulation du moteur WASM pour le test standalone
        class TestWASMEngine {
            constructor() {
                this.isReady = false
                this.totalCalculations = 0
                this.totalTime = 0
                this.initialize()
            }
            
            async initialize() {
                // Simulation d'initialisation
                await new Promise(resolve => setTimeout(resolve, 100))
                this.isReady = true
                this.log('‚úÖ Moteur JavaScript ultra-optimis√© initialis√©')
                this.updateStatus()
            }
            
            async waitForReady() {
                return this.isReady
            }
            
            configure(config) {
                this.config = config
                this.log(`üîß Configuration mise √† jour: ${config.colsCount}x${config.rowsCount}`)
            }
            
            calculateHighlight(mouseX, mouseY) {
                const start = performance.now()
                
                if (!this.config) return null
                
                // Simulation des calculs ultra-optimis√©s
                const gridRect = document.getElementById('testGrid').getBoundingClientRect()
                const relativeX = mouseX - gridRect.left - 10 // padding
                const relativeY = mouseY - gridRect.top - 10
                
                const cellWidth = (gridRect.width - 20) / this.config.colsCount // 20 = padding
                const cellHeight = (gridRect.height - 20) / this.config.rowsCount
                
                const colIndex = Math.max(0, Math.min(Math.floor(relativeX / cellWidth), this.config.colsCount - 1))
                const rowIndex = Math.max(0, Math.min(Math.floor(relativeY / cellHeight), this.config.rowsCount - 1))
                
                const end = performance.now()
                const calcTime = end - start
                
                this.totalCalculations++
                this.totalTime += calcTime
                
                return {
                    colIndex,
                    rowIndex,
                    calculationTime: calcTime
                }
            }
            
            getPerformanceStats() {
                return {
                    totalCalculations: this.totalCalculations,
                    totalTime: this.totalTime,
                    averageTime: this.totalCalculations > 0 ? this.totalTime / this.totalCalculations : 0
                }
            }
            
            log(message) {
                const timestamp = new Date().toLocaleTimeString()
                const logElement = document.getElementById('log')
                logElement.innerHTML += `[${timestamp}] ${message}\n`
                logElement.scrollTop = logElement.scrollHeight
            }
            
            updateStatus() {
                const statusElement = document.getElementById('engineStatus')
                if (this.isReady) {
                    statusElement.textContent = 'Ultra-Optimis√© Actif'
                    statusElement.className = 'engine-status ready'
                } else {
                    statusElement.textContent = 'Initialisation...'
                    statusElement.className = 'engine-status loading'
                }
            }
        }
        
        // Variables globales
        let engine = new TestWASMEngine()
        let lastHighlight = null
        
        // Configuration du test
        const config = {
            gridWidth: 500,
            gridHeight: 400,
            colWidth: 70,
            rowHeight: 50,
            colsCount: 7,
            rowsCount: 8
        }
        
        // Initialisation
        async function initializeTest() {
            await engine.waitForReady()
            engine.configure(config)
            generateGrid()
            startPerformanceMonitoring()
        }
        
        function generateGrid() {
            const grid = document.getElementById('testGrid')
            grid.innerHTML = ''
            
            for (let row = 0; row < config.rowsCount; row++) {
                for (let col = 0; col < config.colsCount; col++) {
                    const cell = document.createElement('div')
                    cell.className = 'grid-cell'
                    cell.textContent = `${col},${row}`
                    cell.setAttribute('data-col', col)
                    cell.setAttribute('data-row', row)
                    grid.appendChild(cell)
                }
            }
        }
        
        function handleGridMouseMove(event) {
            if (!engine.isReady) return
            
            const result = engine.calculateHighlight(event.clientX, event.clientY)
            if (!result) return
            
            // Mise √† jour visuelle
            document.querySelectorAll('.grid-cell').forEach(cell => {
                cell.classList.remove('highlighted')
            })
            
            const targetCell = document.querySelector(`[data-col="${result.colIndex}"][data-row="${result.rowIndex}"]`)
            if (targetCell) {
                targetCell.classList.add('highlighted')
            }
            
            lastHighlight = result
        }
        
        function startPerformanceMonitoring() {
            setInterval(() => {
                const stats = engine.getPerformanceStats()
                
                document.getElementById('totalCalculations').textContent = stats.totalCalculations.toLocaleString()
                document.getElementById('averageTime').textContent = stats.averageTime.toFixed(6)
                document.getElementById('theoreticalFPS').textContent = stats.averageTime > 0 ? Math.round(1000 / stats.averageTime) : '‚àû'
                document.getElementById('engineType').textContent = 'JS-Optimized'
                
                // Indicateur de performance
                const perfElement = document.getElementById('performanceIndicator')
                const avgTime = stats.averageTime
                
                if (avgTime <= 0.01) {
                    perfElement.innerHTML = '<span class="emoji">üöÄ</span>Performance: EXCELLENTE (' + avgTime.toFixed(6) + 'ms)'
                    perfElement.style.background = 'linear-gradient(135deg, #00b09b 0%, #96c93d 100%)'
                } else if (avgTime <= 0.05) {
                    perfElement.innerHTML = '<span class="emoji">‚ö°</span>Performance: TR√àS BONNE (' + avgTime.toFixed(6) + 'ms)'
                    perfElement.style.background = 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)'
                } else {
                    perfElement.innerHTML = '<span class="emoji">‚ö†Ô∏è</span>Performance: ACCEPTABLE (' + avgTime.toFixed(6) + 'ms)'
                    perfElement.style.background = 'linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%)'
                }
            }, 500)
        }
        
        // Fonctions de test
        window.runBenchmark = async function() {
            engine.log('üèÅ D√©marrage du benchmark de performance...')
            
            const iterations = 10000
            const testPositions = []
            
            // G√©n√©rer des positions de test
            for (let i = 0; i < iterations; i++) {
                testPositions.push({
                    x: Math.random() * 500 + 100,
                    y: Math.random() * 400 + 100
                })
            }
            
            const startTime = performance.now()
            
            for (const pos of testPositions) {
                engine.calculateHighlight(pos.x, pos.y)
            }
            
            const endTime = performance.now()
            const totalTime = endTime - startTime
            const avgTime = totalTime / iterations
            
            engine.log(`üìä Benchmark termin√©:`)
            engine.log(`   ‚Ä¢ ${iterations} calculs en ${totalTime.toFixed(2)}ms`)
            engine.log(`   ‚Ä¢ Moyenne: ${avgTime.toFixed(6)}ms par calcul`)
            engine.log(`   ‚Ä¢ D√©bit: ${Math.round(iterations / (totalTime / 1000))} calculs/sec`)
            
            if (avgTime <= 0.01) {
                engine.log('üèÜ Performance EXCELLENTE!')
            } else if (avgTime <= 0.05) {
                engine.log('‚ö° Performance TR√àS BONNE!')
            } else {
                engine.log('‚ö†Ô∏è Performance acceptable')
            }
        }
        
        window.runAccuracyTest = function() {
            engine.log('üéØ Test de pr√©cision en cours...')
            
            const testCases = [
                { x: 150, y: 100, expectedCol: 2, expectedRow: 1 },
                { x: 80, y: 60, expectedCol: 1, expectedRow: 0 },
                { x: 450, y: 350, expectedCol: 6, expectedRow: 6 }
            ]
            
            let passed = 0
            
            testCases.forEach((test, index) => {
                const result = engine.calculateHighlight(test.x + 50, test.y + 50) // Offset pour la grille
                if (result && result.colIndex === test.expectedCol && result.rowIndex === test.expectedRow) {
                    engine.log(`   ‚úÖ Test ${index + 1}: Correct (${result.colIndex}, ${result.rowIndex})`)
                    passed++
                } else {
                    engine.log(`   ‚ùå Test ${index + 1}: Attendu (${test.expectedCol}, ${test.expectedRow}), obtenu (${result?.colIndex}, ${result?.rowIndex})`)
                }
            })
            
            engine.log(`üìã R√©sultats: ${passed}/${testCases.length} tests r√©ussis`)
        }
        
        window.runStressTest = function() {
            engine.log('üí™ Test de stress en cours...')
            
            let count = 0
            const maxIterations = 50000
            
            const stressLoop = () => {
                for (let i = 0; i < 100; i++) {
                    if (count >= maxIterations) break
                    
                    const x = Math.random() * 600
                    const y = Math.random() * 500
                    engine.calculateHighlight(x, y)
                    count++
                }
                
                if (count < maxIterations) {
                    requestAnimationFrame(stressLoop)
                } else {
                    engine.log(`üî• Test de stress termin√©: ${maxIterations} calculs`)
                    const stats = engine.getPerformanceStats()
                    engine.log(`‚ö° Performance moyenne: ${stats.averageTime.toFixed(6)}ms`)
                }
            }
            
            stressLoop()
        }
        
        window.clearLog = function() {
            document.getElementById('log').innerHTML = ''
        }
        
        // D√©marrage
        initializeTest()
    </script>
</body>
</html>
