<!DOCTYPE html>
<html>
<head>
    <title>Debug User Role</title>
</head>
<body>
    <h1>Debug User Role</h1>
    <div id="status">Loading...</div>
    <button id="checkRole">Vérifier le rôle utilisateur</button>
    
    <script type="module">
        import { auth, db } from '/src/services/firebase.ts'
        import { onAuthStateChanged } from 'firebase/auth'
        import { doc, getDoc } from 'firebase/firestore'
        import { AuthService } from '/src/services/auth.ts'
        
        const statusDiv = document.getElementById('status')
        const checkRoleBtn = document.getElementById('checkRole')
        
        let currentUser = null
        
        onAuthStateChanged(auth, (user) => {
            currentUser = user
            if (user) {
                statusDiv.innerHTML = `
                    <p><strong>Utilisateur connecté:</strong> ${user.email}</p>
                    <p><strong>UID:</strong> ${user.uid}</p>
                    <p><strong>Tenant ID:</strong> ${AuthService.currentTenantId}</p>
                `
            } else {
                statusDiv.innerHTML = '<p>Aucun utilisateur connecté</p>'
            }
        })
        
        checkRoleBtn.addEventListener('click', async () => {
            if (!currentUser) {
                statusDiv.innerHTML += '<p style="color: red;">Aucun utilisateur connecté</p>'
                return
            }
            
            try {
                const tenantUser = await AuthService.getUserRole(currentUser.uid)
                statusDiv.innerHTML += `
                    <hr>
                    <h3>Informations du rôle:</h3>
                    <pre>${JSON.stringify(tenantUser, null, 2)}</pre>
                    <p><strong>Rôle:</strong> ${tenantUser?.role || 'NON DÉFINI'}</p>
                    <p><strong>Email admin configuré:</strong> ${AuthService.adminEmails.includes(currentUser.email.toLowerCase())}</p>
                    <p><strong>Emails admin configurés:</strong> ${JSON.stringify(AuthService.adminEmails)}</p>
                `
            } catch (error) {
                statusDiv.innerHTML += `<p style="color: red;">Erreur: ${error.message}</p>`
                console.error('Error fetching user role:', error)
            }
        })
    </script>
</body>
</html>
